!function(e){function t(i){if(n[i])return n[i].exports;var a=n[i]={exports:{},id:i,loaded:!1};return e[i].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1),o=i(a),u=io(),r=o["default"].$(".input"),c=o["default"].$(".send"),d=o["default"].$(".message ul"),l=o["default"].$(".inputname"),s=o["default"].$(".confirm"),f=o["default"].$("#shade"),p=o["default"].$(".userlist"),m=o["default"].$(".users .nums"),g=o["default"].$(".upload");l.focus();var v=function(e,t){var n=o["default"].$c("li",{className:"chatitem "+(t?"myself":"others")}),i=o["default"].$c("span",{className:"time",textContent:"("+o["default"].timeformat(e.time)+")"}),a=o["default"].$c("p",{className:"username"}),u=document.createTextNode(e.username+(t?"-我":""));t?(a.appendChild(i),a.appendChild(u)):(a.appendChild(u),a.appendChild(i));var r=o["default"].$c("p",{className:"msg",innerHTML:e.msg});n.appendChild(a),n.appendChild(r),d.appendChild(n),n.scrollIntoView()},h=function(e,t){p.innerHTML="";var e=u.id;t.forEach(function(t){var n=o["default"].$c("li",{id:"id"+t.id,textContent:t.username+(t.id===e?"(我)":"")});p.appendChild(n)})},$=function(e,t,n){var i=u.id===t;if(i)f.style.display="none",r.focus();else if(!u.isLogin)return;h(t,n),m.textContent=n.length,y(e+" 加入群聊","userjoin")},C=function(e,t,n){var i=o["default"].$("#id"+e);i.parentNode.removeChild(i),m.textContent=n,y(t+"退出群聊","userout")},y=function(e,t){var n=o["default"].$c("li",{className:"chatitem msgitem "+t,innerHTML:'<p class="msgcontent">'+e+"</p>"});d.appendChild(n),n.scrollIntoView()},T=function x(e){x.wait=1e3,clearTimeout(x[e]);var t=o["default"].$("#id"+e);t.querySelector(".inputing")||t.appendChild(o["default"].$c("span",{className:"inputing",textContent:"（正在输入……）"})),x[e]=setTimeout(function(){var e=t.querySelector(".inputing");clearTimeout(x.st),e.parentNode.removeChild(e)},x.wait)},L=function(e){l.classList.add("conflict"),l.setAttribute("placeholder","昵称"+e+"已被占用"),l.value="",f.style.display="",l.focus()},M=function(e){var t=new FileReader,n=e.target.files[0];if(n){if(!/^image\/[a-z]+$/.test(n.type))return void y("请选择图片","warning");if(n.size>51200)return void y("图片不得超过50k","warning");t.readAsDataURL(n),t.onload=function(e){r.innerHTML+="<img src="+e.target.result+" />",e.target.value=""}}};r.onkeydown=function(e){return 13==e.keyCode?(c.click(),!1):void 0},l.onkeydown=function(e){13==e.keyCode&&s.click()},document.body.ontouchmove=function(){return!1},u.on("connect",function(){s.onclick=function(){var e=l.value.replace(/\s/g,"");e?u.emit("join",e,u.id):l.focus()},u.on("conflict"+u.id,L),u.on("userjoin",function(e,t,n){$(e,t,n),u.id===t&&(u.isLogin=!0,u.on("userout",C),u.on("inputing",T),c.onclick=function(){var e=r.innerHTML.trim();e&&(u.emit("chat",e),r.innerHTML="")},r.oninput=function(){u.emit("inputing"),this.innerHTML=this.innerHTML.replace(/<[^img\s*][^>]*>/g,"")+""},document.ondrop=function(e){var t=e.dataTransfer;return e.target==r&&M({target:t}),t.files.length>0?!1:void 0},u.on("chat",function(e){v(e,e.id===u.id)}),g.onchange=M)})})},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={$:function(e){return document.querySelector(e)},$$:function(e){return document.querySelectorAll(e)},$c:function(e,t){var n=document.createElement(e);return Object.assign(n,t),n},timeformat:function(e){var t=new Date(e),n=t.getMonth()+1,i=t.getDate(),a=t.getHours(),o=t.getMinutes(),u=t.getSeconds();return n=n>9?n:"0"+n,i=i>9?i:"0"+i,a=a>9?a:"0"+a,o=o>9?o:"0"+o,u=u>9?u:"0"+u,n+"-"+i+" "+a+":"+o+":"+u}}}]);